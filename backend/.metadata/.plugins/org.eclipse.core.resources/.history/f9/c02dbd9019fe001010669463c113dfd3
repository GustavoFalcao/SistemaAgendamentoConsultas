import java.util.Scanner;

public class Main {

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);

        Usuario admin = new Administrador("admin", "123");
        Usuario operador = new Operador("user", "123");

        System.out.println("=== SISTEMA DE AGENDAMENTO ===");
        System.out.print("Usuário: ");
        String u = sc.nextLine();
        System.out.print("Senha: ");
        String s = sc.nextLine();

        Usuario logado = null;
        if (admin.autenticar(u, s)) logado = admin;
        else if (operador.autenticar(u, s)) logado = operador;

        if (logado == null) {
            System.out.println("Login inválido.");
            sc.close();
            return;
        }

        Log.registrar(logado.getUsername(), "Login no sistema");

        int op;
        do {
            System.out.println("\n1 - Cadastrar paciente");
            System.out.println("2 - Cadastrar médico");
            System.out.println("3 - Agendar consulta");
            System.out.println("4 - Listar consultas");
            System.out.println("5 - Cancelar consulta (admin)");
            System.out.println("0 - Sair");
            op = sc.nextInt();
            sc.nextLine();

            switch (op) {
                case 1:
                    System.out.print("Nome: ");
                    String nome = sc.nextLine();
                    System.out.print("CPF: ");
                    String cpf = sc.nextLine();
                    Sistema.cadastrarPaciente(new Paciente(nome, cpf), logado);
                    break;

                case 2:
                    System.out.print("Nome médico: ");
                    String nm = sc.nextLine();
                    System.out.print("Especialidade: ");
                    String esp = sc.nextLine();
                    Sistema.cadastrarMedico(new Medico(nm, esp), logado);
                    break;

                case 3:
                    System.out.print("Data: ");
                    String data = sc.nextLine();
                    System.out.print("Horário: ");
                    String horario = sc.nextLine();
                    Consulta c = new Consulta(
                        Sistema.pacientes.get(0),
                        Sistema.medicos.get(0),
                        data, horario);
                    Sistema.agendarConsulta(c, logado);
                    break;

                case 4:
                    for (Consulta con : Sistema.consultas) {
                        System.out.println(con);
                    }
                    break;

                case 5:
                    Sistema.cancelarConsulta(0, logado);
                    break;
            }
        } while (op != 0);

        Log.registrar(logado.getUsername(), "Logout");
        sc.close();
    }
}
